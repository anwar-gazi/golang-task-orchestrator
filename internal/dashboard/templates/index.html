{{define "content"}}
<div class="grid">
  <div class="card">
    <div class="stat-label">Pending Tasks</div>
    <div class="stat-value">{{.Stats.PendingTasks}}</div>
  </div>
  <div class="card">
    <div class="stat-label">Running Tasks</div>
    <div class="stat-value" style="color: var(--primary)">{{.Stats.RunningTasks}}</div>
  </div>
  <div class="card">
    <div class="stat-label">Active Workers</div>
    <div class="stat-value" style="color: var(--success)">{{.Stats.ActiveWorkers}}</div>
  </div>
  <div class="card">
    <div class="stat-label">Failed Tasks</div>
    <div class="stat-value" style="color: var(--danger)">{{.Stats.FailedTasks}}</div>
  </div>
</div>

<div class="card">
  <div class="stat-label" style="margin-bottom: 0.5rem">Registered Task Handlers</div>
  <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
    {{range .Stats.RegisteredHandlers}}
    <form action="/tasks/run" method="POST" style="display: flex; align-items: center;">
      <input type="hidden" name="type" value="{{.}}">
      <div class="badge badge-pending" style="display: flex; align-items: center; gap: 0.5rem; padding-right: 0.25rem;">
        {{.}}
        <button type="submit"
          style="border: none; background: rgba(0,0,0,0.1); cursor: pointer; border-radius: 4px; padding: 2px 6px; font-size: 0.75rem; color: inherit;">
          Run
        </button>
      </div>
    </form>
    {{else}}
    <span class="text-muted">No handlers registered</span>
    {{end}}
  </div>
</div>

<div class="card">
  <h3>Recent Tasks</h3>
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Type</th>
        <th>Status</th>
        <th>Priority</th>
        <th>Created</th>
      </tr>
    </thead>
    <tbody>
      {{range .RecentTasks}}
      <tr>
        <td><a href="/tasks/{{.ID}}">{{.ID}}</a></td>
        <td>{{.Type}}</td>
        <td><span class="badge badge-{{.Status}}">{{.Status}}</span></td>
        <td>{{.Priority}}</td>
        <td>
          {{if eq .Status "running"}}
          <form action="/tasks/cancel" method="POST" style="display: inline;">
            <input type="hidden" name="id" value="{{.ID}}">
            <button type="submit"
              style="color: red; border: 1px solid red; background: none; border-radius: 4px; padding: 2px 6px; cursor: pointer; font-size: 0.75rem;">Stop</button>
          </form>
          {{else}}
          {{formatTime .CreatedAt}}
          {{end}}
        </td>
      </tr>
      {{end}}
    </tbody>
  </table>
</div>
{{end}}